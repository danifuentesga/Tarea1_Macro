---
title: ""
author: ""
date: ""
output: pdf_document
geometry: margin=1in
fontsize: 12pt
---

```{=tex}
\begin{center}

% Insertar la imagen (ajusta el nombre y tamaño según necesites)
\includegraphics[width=10cm]{colmex.jpg}  

\vspace{0.6cm}  

{\Large \textbf{Maestría en Economía}}  

\vspace{0.3cm}

{\Large \textbf{2024-2026}}  

\vspace{0.6cm}  

\textcolor{red!50!black}{\noindent\rule{16cm}{0.8pt}}  % Línea horizontal  
\vspace{0.5cm}  

{\Huge \textbf{Macroeconomia II}}

\vspace{0.5cm} 

{\large \textbf{Tarea 1}} 

\vspace{0.5cm}  
\textcolor{red!50!black}{\noindent\rule{16cm}{0.8pt}}  % Línea horizontal    



{\LARGE \textbf{Elaborado por:}}  
\vspace{0.3cm}  

{\large José Daniel Fuentes García}  

{\large Paola Jaqueline González Reyes}  

{\large Raymundo Ramírez Peralta}  

\vspace{0.5cm}  

{\LARGE \textbf{Profesor}}  
\vspace{0.3cm}  

{\large Santiago C. Bazdresch}  

\vspace{0.5cm}  

{\LARGE \textbf{Fecha}}  
\vspace{0.3cm}  

{\large 21 de Febrero de 2025} 
  

\end{center}
```
\newpage

## **Instrucciones**

Realice los siguientes ejercicios en su equipo de trabajo designado.\
La tarea se califica del 0 al 15.

## **Ejercicio 1**

Resuelva los ejercicios 11.8 y 11.9 (5a Ed.). Realice estos con ayuda de su laboratorista y entregue las soluciones a máquina, utilizando LaTeX. [4 horas,1 punto cada ejercicio]

### *Romer 11.8*

**Modelo de Insiders-Outsiders**: Consideremos la siguiente variante del modelo en las ecuaciones (11.39)–(11.42).\
Las ganancias de la empresa están dadas por: $\pi = AF(L_I + L_O) - w_I L_I - w_O L_O,$ donde $L_I$ y $L_O$ son las cantidades de trabajadores **insiders** y **outsiders** que la empresa contrata, y $w_I$ y $w_O$ son sus respectivos salarios. $L_I$ siempre es igual a $\overline{L}_I$, y la utilidad de los insiders en el estado $i$ es simplemente: $u_{Ii} = U(w_{Ii}),$donde $U'(\bullet) > 0$ y $U''(\bullet) < 0$.Capturamos la idea de que los salarios de los **insiders** y **outsiders** no pueden fijarse de manera independiente, asumiendo que el salario de los **outsiders** está dado por: $w_{Oi} = R w_{Ii}, \quad \text{donde} \quad 0 < R \leq 1.$

#### *a)*
Considere como variables de elección de la empresa a $w_I$ y $L_O$ en cada estado, con $w_{Oi}$ dado por: $$
w_{Oi} = R w_{Ii}.
$$ Formule el **Lagrangiano** análogo a (11.43) para el problema de la empresa, que consiste en maximizar sus **ganancias esperadas**, sujeto a la restricción de que la **utilidad esperada de los insiders** sea $u_0$.

##### \textcolor{red}{RESPUESTA}

La empresa maximiza sus **beneficios esperados**:$$
\pi_i = AF(L_I + L_O) - w_{I_i} L_I - w_{O_i} L_O
$$ con la restricción de que la **utilidad esperada de los insiders** es al menos $u_0$. Se asume que los salarios de los outsiders están vinculados a los de los insiders: $$
w_{O_i} = R w_{I_i}, \quad 0 < R \leq 1.
$$ Dado el Lagrangiano de la ecuación **(11.43)** del libro, el nuevo Lagrangiano adaptado a este problema es: $$
\mathcal{L} = \sum_{i=1}^{K} p_i \left[ AF(L_I + L_{O_i}) - w_{I_i} L_I - R w_{I_i} L_{O_i} \right] + \lambda \left( \sum_{i=1}^{K} p_i U(w_{I_i}) - u_0 \right)
$$

Este Lagrangiano indica la maximización de los beneficios esperados de la empresa, donde se eligen $w_{I_i}$ y $L_{O_i}$ como variables de decisión, es decir , el empresario las puede controlar. La función objetivo incluye los beneficios que se obtienen de la producción menos los costos salariales de insiders y outsiders, considerando que los salarios de estos últimos (outsiders) dependen de los salarios de los insiders. Lo importante es que **la restricción impone que la utilidad esperada de los insiders tiene que ser al menos** $u_0$, **asegurando que los salarios sean suficientemente altos para ellos (insiders).**

La empresa debe encontrar un equilibrio entre maximizar sus beneficios y cumplir con la restricción de utilidad de los insiders. El multiplicador de Lagrange $\lambda$ indica el peso de esta restricción: si $\lambda > 0$, **significa que la empresa está limitada por la necesidad de mantener satisfechos a los insiders**, mientras que si $\lambda = 0$, la restricción no es relevante porque ya se cumple sin necesidad de ajustes.

#### *b)*

Determina la condición de primer orden para $L_{O_i}$. ¿Escoge la empresa el nivel de empleo de manera que el producto marginal del trabajo y el salario real sean iguales en todos los estados? Asume que siempre existe una solución interior para $L_{O_i}$.

##### \textcolor{red}{RESPUESTA}

La empresa maximiza el lagrangiano que planteamos en el inciso anterior:

$$
\mathcal{L} = \sum_{i=1}^{K} p_i \left[ AF(L_I + L_{O_i}) - w_{I_i} L_I - R w_{I_i} L_{O_i} \right] + \lambda \left( \sum_{i=1}^{K} p_i U(w_{I_i}) - u_0 \right)
$$

Derivamos con respecto a $L_{O_i}$:

$$
p_i \left[ A F'(L_I + L_{O_i}) - R w_{I_i} \right] = 0
$$

El ejericio nos deja asumir que existe una solucion interior, por tanto para el **óptimo interior**, se cumple:

$$
A F'(L_I + L_{O_i}) = R w_{I_i}
$$

La derivada nos indica que el **producto marginal del trabajo (MPL)** para los outsiders se iguala a su **salario real** $R w_{I_i}$, pero no al salario total de los insiders.

Esto quiere decir que: Si $R = 1$, la empresa contrata outsiders como si fueran insiders, con el mismo salario.Si $R < 1$, los outsiders reciben un salario menor que su MPL en comparación con los insiders.

Podemos decir entonces que la empresa **no elige el empleo de tal forma que el MPL sea igual al salario en todos los estados**, sino que va modificando el nivel de las contrataciones de outsiders en función de $R$, lo cual plasma el **hecho estilizado 2)** visto en clase del mercado laboral sobre las rigideces salariales en el mercado laboral.

#### *c)*

Determina la condición de primer orden para $w_{I_i}$.Cuando $L_{O_i}$ es más alto, ¿$w_{I_i}$ aumenta, disminuye o no cambia? (Suponemos que siempre existe una solución interior para $L_{O_i}$.)

##### \textcolor{red}{RESPUESTA}

La empresa maximiza el siguiente **Lagrangiano**:

$$
\mathcal{L} = \sum_{i=1}^{K} p_i \left[ AF(L_I + L_{O_i}) - w_{I_i} L_I - R w_{I_i} L_{O_i} \right] + \lambda \left( \sum_{i=1}^{K} p_i U(w_{I_i}) - u_0 \right)
$$

Derivamos con respecto a $w_{I_i}$:

$$
p_i \left[ -L_I - R L_{O_i} \right] + \lambda p_i U'(w_{I_i}) = 0
$$

Despejamos:

$$
L_I + R L_{O_i} = \lambda U'(w_{I_i})
$$

Despues de realizar el lagranjeano notamos que **cuando** $L_{O_i}$ aumenta, el lado izquierdo de la ecuación también debe aumentar. Recordemos que $U'(w_{I_i})$ es **decreciente** (porque $U(w)$ es cóncava), entonces $w_{I_i}$ debe aumentar para restaurar el equilibrio.O dicho de otra forma , un mayor número de outsiders **incrementa los salarios de los insiders**.

La condición de primer orden que obtuvimos indica que cuando $L_{O_i}$ aumenta, el salario de los insiders $w_{I_i}$ también aumenta. La implicacion importante de este resultado es que la empresa necesita **compensar a los insiders con salarios más altos** cuando hay más competencia de los outsiders.Lo que sugiere algún tipo de poder de negociación de los insiders o un ajuste en los incentivos salariales para evitar la rotación o el shirking.

### *Romer 11.9*

**Modelo de Harris-Todaro**: Supongamos que existen dos sectores en la economía. Los trabajos en el sector primario pagan un salario $w_p$, mientras que los trabajos en el sector secundario pagan un salario $w_s$. Cada trabajador decide en qué sector trabajar. Si elige el sector secundario, obtiene un empleo automáticamente. Sin embargo, en el sector primario solo hay un número fijo de empleos $N_p$, los cuales se asignan aleatoriamente entre los trabajadores que lo eligen. Aquellos que no obtienen empleo en el sector primario quedan desempleados y reciben un beneficio por desempleo $b$. Los trabajadores son neutrales al riesgo y no hay desutilidad por trabajar. Por lo tanto, la utilidad esperada de un trabajador que elige el sector primario es $q w_p + (1 - q) b$, donde $q$ es la probabilidad de obtener un empleo en el sector primario. Se asume que $b < w_s < w_p$ y que $\frac{N_p}{\bar{N}} < \frac{w_s - b}{w_p - b}$.

#### *a)*

Determina el desempleo de equilibrio como una función de $w_p$, $w_s$, $N_p$, $b$ y el tamaño de la fuerza laboral $\bar{N}$.

##### \textcolor{red}{RESPUESTA}

En equilibrio, los trabajadores deben ser indiferentes entre trabajar en el sector secundario o trabajar en el sector primario. Esto nos sugiere que la utilidad esperada de un trabajador del sector primario es igual al salario de un trabajador del sector secundario. Esto es :

$$
q w_p + (1 - q) b = w_s
$$

donde $q$ es la probabilidad de obtener un empleo en el sector primario, definida como:

$$
q = \frac{N_p}{L_p}
$$

donde $L_p$ es la cantidad total de trabajadores que buscan entrar al sector primario. Despejamos $L_p$:

$$
L_p = \frac{N_p}{q}
$$

Sustituyendo $q$ en la primer ecuación de indiferencia que usamos:

$$
\frac{N_p}{L_p} w_p + \left( 1 - \frac{N_p}{L_p} \right) b = w_s
$$

Resolvemos para $L_p$:

$$
L_p = N_p \frac{w_p - b}{w_s - b}
$$

Dado que la fuerza laboral total es $\bar{N}$, el desempleo de equilibrio $U$ es la cantidad de trabajadores en el sector primario que no logran conseguir empleo:

$$
U = L_p - N_p
$$

Sustituimos $L_p$:

$$
U = N_p \frac{w_p - b}{w_s - b} - N_p
$$

Factorizamos $N_p$:

$$
U = N_p \left( \frac{w_p - b}{w_s - b} - 1 \right)
$$

Por lo tanto, el desempleo de equilibrio es:

$$
U = N_p \frac{w_p - w_s}{w_s - b}
$$

La ecuación del desempleo de equilibrio muestra que el desempleo depende de la cantidad de empleos en el sector primario ($N_p$), la brecha salarial entre sectores ($w_p - w_s$) y el beneficio por estar en el desempleo ($b$).**Si** $w_p$ aumenta, más trabajadores buscan el sector primario, aumentando el desempleo.**Si** $w_s$ o $b$ aumentan, menos trabajadores intentan el sector primario, reduciendo el desempleo. **Cuando** $w_s \to w_p$, el desempleo desaparece, pues ambos sectores ofrecen condiciones similares.

#### *b)*

¿Cómo afecta un aumento en $N_p$ al desempleo? Explica intuitivamente por qué, aunque el desempleo se presenta en forma de trabajadores esperando empleos en el sector primario, un aumento en la cantidad de estos empleos puede incrementar el desempleo.

##### \textcolor{red}{RESPUESTA}

El desempleo de equilibrio está dado por la ecuación:

$$
U = N_p \frac{w_p - w_s}{w_s - b}
$$

Un aumento en $N_p$ puede aumentar el desempleo porque, aunque existan más empleos en el sector primario, también aumenta la cantidad de trabajadores que intentan ingresar a este sector. Como los salarios en el sector primario $w_p$ son más altos que en el sector secundario $w_s$, hay mas incentivos para elegir este sector. Sin embargo, como los empleos en el sector primario se asignan aleatoriamente, la proporción de trabajadores desempleados va a crecer.

Por tanto, aumentar $N_p$ no necesariamente reduce el desempleo, ya que puede generar una mayor cantidad de trabajadores intentando entrar al sector primario sin garantizar un lugar para todos. Esto muestra que **los incentivos salariales y las expectativas de los trabajadores son clave en la determinación del desempleo estructural**.

#### *c)*

¿Cuáles son los efectos de un aumento en el nivel de los beneficios por estar en el desempleo?

##### \textcolor{red}{RESPUESTA}

Un aumento en los beneficios por desempleo ($b$) modifica la ecuación de varias formas:

1.  **Disminuye el incentivo a aceptar empleos en el sector secundario**
    -   Si $b$ se acerca a $w_s$, los trabajadores tienen menos incentivos para aceptar trabajos en el sector secundario, ya que el desempleo se vuelve menos costoso ( o aumnetan sus beneficios).Esto lleva a más trabajadores a intentar entrar al sector primario, lo que aumenta la cantidad de desempleados.
2.  **Reduce la brecha entre sectores**
    -   Si $b$ aumenta, el denominador de la ecuación $(w_s - b)$ se reduce, lo que **aumenta el desempleo** porque la proporción de trabajadores buscando empleo en el sector primario crece.
3.  **Efecto sobre la decisión de búsqueda**
    -   Un beneficio por desempleo más alto reduce el costo de estar desempleado, lo que incentiva a los trabajadores a **tomarse más tiempo para encontrar un empleo en el sector primario en lugar de aceptar trabajos en el sector secundario**.

## **Ejercicio 2**

Estudie el mercado laboral en México siguiendo estos pasos: [2 horas, 0.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar.**

### *a)* 
Obtenga diversas series anuales de los salarios (remuneraciones) en términos reales, en México, que abarquen el periodo de la pandemia. Grafíquelas en un solo panel.Genere las series de sus tasa de cambio anual, calcule la volatilidad de la series de tasa de cambio.

A continuación se presentan la serie de tiempo del Índice Global de los Salarios Medios Reales - los cuales son una aproximación a las remuneraciones medias reales con base en el personal ocupado de los sectores no agropecuarios tomando como base el año 2018 - a partir de enero de 2019 a noviembre de 2024 recuperados del Instituto Nacional de Estadística, Geografía e Informática (INEGI).

```{r,echo=FALSE,warning = FALSE,message=FALSE}
# Lista de paqueterías a instalar
paquetes <- c("readr", "readxl", "dplyr", "tidyr", "ggplot2", "ggrepel", "patchwork", "scales", "stringr", "kableExtra", "gt")

# Instalar paqueterías que no estén ya instaladas
for (paquete in paquetes) {
  if (!require(paquete, character.only = TRUE)) {
    install.packages(paquete)
  }
}
```
```{r,echo = FALSE,warning = FALSE,message=FALSE}
library(readr)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggrepel)
library(patchwork)
library(scales)
library(stringr)
library(kableExtra)
library(gt)
```
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=3,fig.pos="H", fig.align="center", fig.cap="Índice de salarios medios reales"}

# Cargar librerías necesarias
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)

# Leer el archivo desde el dominio de trabajo sin ruta absoluta
WDATA <- read_csv("WDATA.csv")

# Definir los nombres de los meses en español
meses_es <- c("enero", "febrero", "marzo", "abril", "mayo", "junio",
              "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre")

# Transformar los datos a formato largo y crear variables de fecha
WDATA_long <- WDATA %>%
  pivot_longer(cols = starts_with("ind"),  
               names_to = "Año",          
               values_to = "Índice") %>%  
  mutate(Año = case_when(
    Año == "ind9" ~ 2019,
    Año == "ind0" ~ 2020,
    Año == "ind1" ~ 2021,
    Año == "ind2" ~ 2022,
    Año == "ind3" ~ 2023,
    Año == "ind4" ~ 2024
  )) %>%
  mutate(Mes_Num = match(tolower(Mes), meses_es)) %>%
  mutate(Fecha = as.Date(paste0(Año, "-", Mes_Num, "-01"))) %>%
  na.omit()

# Filtrar los puntos de interés para cada enero
WDATA_puntos <- WDATA_long %>%
  filter(Mes_Num == 1)

# Crear la gráfica con el nuevo formato
grafica_indexw <- ggplot(WDATA_long, aes(x = Fecha, y = Índice)) +
  geom_line(color = "#611606", size = 2) +  # Línea principal
  geom_point(data = WDATA_puntos, aes(x = Fecha, y = Índice), color = "#800020", size = 3) +  # Puntos clave
  geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +  # Línea de tendencia
  labs(
    title = "",
    x = "Año",
    y = "Índice"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_line(color = "gray95"),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    plot.title = element_text(hjust = 0.5, face = "bold")
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  ylim(80, 125)

grafica_indexw  # Mostrar la gráfica en el PDF



```

Las tasas de cambio anuales se calcularon de la siguiente manera:

$$TC_{anual}=\frac{X_t-X_{t-1}}{X_{t-1}}$$

donde:
$X_t$ es el mes en el año $t$ 
$X_{t-1}$ es el mismo mes en el año $t-1$. 


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=7, fig.height=6,fig.pos="H", fig.align="center", fig.cap="Tasa de cambio del Indice de slarios medios reales 2019-2024"}

# Cargar librerías necesarias
library(ggplot2)
library(dplyr)
library(patchwork)  # Para combinar gráficos en una cuadrícula

# Definir los nombres de los meses en español
meses_espanol <- c("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
                   "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre")

# Iniciales de los meses para el eje X
iniciales_meses <- c("E", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D")

# Crear el dataframe con los valores anuales
datos <- data.frame(
  Mes = factor(rep(meses_espanol, times = 6), levels = meses_espanol),
  Valor = c(WDATA$va9, WDATA$va0, WDATA$va1, WDATA$va2, WDATA$va3, WDATA$va4),
  Año = rep(c("2019", "2020", "2021", "2022", "2023", "2024"), each = 12)
)

# Función para crear gráficos por año
crear_grafico <- function(df, año) {
  ggplot(df, aes(x = Mes, y = Valor, group = 1)) +
    geom_line(size = 1.2, color = "#781500") +  # Línea principal
    geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +  # Línea de tendencia
    scale_x_discrete(labels = iniciales_meses) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    labs(
      title = año,
      x = "",
      y = "Tasa"
    ) +
    theme_minimal(base_size = 12) +
    theme(
      axis.text.x = element_text(angle = 0, hjust = 0.5, face = "bold"),
      axis.text.y = element_text(face = "bold"),
      axis.title.y = element_text(face = "bold"),
      plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
    ) +
    ylim(min(datos$Valor), max(datos$Valor))
}

# Generar gráficos individuales por año
grafico_2019 <- crear_grafico(subset(datos, Año == "2019"), "2019")
grafico_2020 <- crear_grafico(subset(datos, Año == "2020"), "2020")
grafico_2021 <- crear_grafico(subset(datos, Año == "2021"), "2021")
grafico_2022 <- crear_grafico(subset(datos, Año == "2022"), "2022")
grafico_2023 <- crear_grafico(subset(datos, Año == "2023"), "2023")
grafico_2024 <- crear_grafico(subset(datos, Año == "2024"), "2024")

# Combinar gráficos en una cuadrícula (3x2)
grafica_tasa_cambio_w <- (grafico_2019 | grafico_2020 )/
                          (grafico_2021 | grafico_2022)/
                           (grafico_2023 | grafico_2024)

# Agregar título y caption
grafica_tasa_cambio_w <- grafica_tasa_cambio_w + plot_annotation(
  title = "",
  caption = "Fuente: Elaboración propia con datos del INEGI",
  theme = theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 1)
  )
)

grafica_tasa_cambio_w  # Mostrar la gráfica en el PDF


```

Por otro lado, la volatilidad de las tasas de cambio anuales del índice global de salarios medios reales se calcularon de la siguiente manera:

$$Volatilidad_t=\sigma_t$$

donde:
$\sigma_t$ es la desviación estándar entre las tasas de cambio del periodo $t$.


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Volatilidad de las tasas de cambio anuales del indice de salrios medios reales"}

# Cargar librerías necesarias
library(ggplot2)
library(dplyr)
library(tidyr)

# Calcular la volatilidad de las tasas de cambio por año
volatilidad_tasas <- WDATA %>%
  summarise(
    `2019` = sd(va9, na.rm = TRUE),
    `2020` = sd(va0, na.rm = TRUE),
    `2021` = sd(va1, na.rm = TRUE),
    `2022` = sd(va2, na.rm = TRUE),
    `2023` = sd(va3, na.rm = TRUE),
    `2024` = sd(va4, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = everything(), names_to = "Año", values_to = "Volatilidad") %>%
  mutate(Año = as.numeric(Año))

# Definir los límites del eje Y
lim_y_min <- min(volatilidad_tasas$Volatilidad, na.rm = TRUE) * 0.9
lim_y_max <- max(volatilidad_tasas$Volatilidad, na.rm = TRUE) * 1.2

# Crear la gráfica
graf_volatil <- ggplot(volatilidad_tasas, aes(x = Año, y = Volatilidad)) +
  geom_line(color = "#781500", size = 2) +  # Línea principal
  geom_point(color = "#781500", size = 3) +  # Puntos en cada año
  geom_text(aes(label = round(Volatilidad, 4)), 
            vjust = -1, size = 5, fontface = "bold") +  # Etiquetas de valores
  ylim(lim_y_min, lim_y_max) + 
  labs(
    title = "",
    x = "Año",
    y = "Volatilidad",
    caption = "Fuente: Elaboración propia con datos del INEGI"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

graf_volatil  # Mostrar la gráfica en el PDF

```

### *b)*
Obtenga diversas series anuales del empleo total en México, que abarquen el periodo de la pandemia. Grafíquelas en un solo panel.Genere las series de sus tasa de cambio anual, calcule la volatilidad de las series de tiempo.
A continuación se presentan los datos de los índices de ocupación trimestrales desde el primer trimestre de 2019 hasta el tercer trimestre de 2024. Estos datos han sido obtenidos del Instituto Nacional de Estadística y Geografía (INEGI) a través de la Encuesta Nacional de Ocupación y Empleo (ENOE).
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Índice de ocupación"}

# Cargar librerías necesarias
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)
library(scales)

# Leer el archivo desde el dominio de trabajo sin ruta absoluta
EDATA <- read_excel("EDATA.xlsx")

# Extraer el año y trimestre de la variable "periodo"
EDATA <- EDATA %>%
  mutate(
    Año = as.numeric(str_extract(periodo, "\\d{4}")),
    Trimestre = as.numeric(str_extract(periodo, "(?<=T)\\d"))
  ) %>%
  filter(Año >= 2019)  # Filtrar datos desde 2019 en adelante

# Crear una variable de fecha basada en año y trimestre
EDATA <- EDATA %>%
  mutate(Fecha = as.Date(paste0(Año, "-", (Trimestre - 1) * 3 + 1, "-01")))

# Crear la gráfica
graf_ocupacion <- ggplot(EDATA, aes(x = Fecha, y = ocupacion)) +
  geom_line(color = "#611606", size = 2) +  # Línea principal
  geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +  # Línea de tendencia
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  scale_y_continuous(
    labels = label_comma(),  # Formatea los números con comas
    limits = c(40000000, 70000000)  # Establece los límites del eje Y
  ) +
  labs(
    title = "",
    x = "Año",
    y = "Ocupación",
    caption = "Fuente: Elaboración propia con datos del INEGI"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(size = 12),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank()
  )

graf_ocupacion  # Mostrar la gráfica en el PDF


```
Las tasas de cambio anuales se calcularon de la siguiente manera:

$$TC_{anual}=\frac{Y_t-Y_{t-1}}{X_{Y-1}}$$

donde: 

$Y_t$ es el trimestre en el año $t$ 
$X_{t-1}$ es el mismo mes en el año $t-1$. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Tasas de cambio anuales del índice de ocupación 2019-2024"}

# Cargar librerías necesarias
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)

# Leer el archivo desde el dominio de trabajo sin ruta absoluta
EDATA <- read_excel("EDATA.xlsx")

# Renombrar la variable "tasa de cambio" a "tc" y extraer año y trimestre
EDATA <- EDATA %>%
  rename(tc = `tasa de cambio`) %>%
  mutate(
    Año = as.numeric(str_extract(periodo, "\\d{4}")),
    Trimestre = as.numeric(str_extract(periodo, "(?<=T)\\d"))
  ) %>%
  filter(Año >= 2019) %>%
  mutate(Fecha = as.Date(paste0(Año, "-", (Trimestre - 1) * 3 + 1, "-01")))

# Crear la gráfica
graf_tc_ocupacion <- ggplot(EDATA, aes(x = Fecha, y = tc)) +
  geom_line(color = "#781500", size = 2) +  # Línea principal
  geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +  # Línea de tendencia
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(
    title = "",
    x = "Año",
    y = "Tasa",
    caption = "Fuente: Elaboración propia con datos del INEGI"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 15, hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(size = 12),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank()
  )

graf_tc_ocupacion  #Mostrar la gráfica en el PDF
```

Por otro lado, la volatilidad de las tasas de cambio anuales del índice global de salarios medios reales se calcularon de la siguiente manera:

$$Volatilidad_t=\sigma_t$$

donde $\sigma_t$ es la desviación estándar entre las tasas de cambio del periodo $t$.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Volatilidad de las tasas de ocupación 2019-2024"}
# Cargar librerías necesarias
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)

# Leer el archivo desde el dominio de trabajo sin ruta absoluta

# Extraer el año de la variable "periodo" y filtrar desde 2019
EDATA <- EDATA %>%
  mutate(Año = as.numeric(str_extract(periodo, "\\d{4}"))) %>%
  filter(Año >= 2019)

# Calcular la volatilidad (desviación estándar) de las tasas de ocupación por año
volatilidad_tasas <- EDATA %>%
  group_by(Año) %>%
  summarise(Volatilidad = sd(tc, na.rm = TRUE)) %>%
  ungroup()

# Definir los límites del eje Y
lim_y_min <- min(volatilidad_tasas$Volatilidad, na.rm = TRUE) * 0.9
lim_y_max <- max(volatilidad_tasas$Volatilidad, na.rm = TRUE) * 1.2

# Crear la gráfica
graf_volatil_ocupacion <- ggplot(volatilidad_tasas, aes(x = Año, y = Volatilidad)) +
  geom_line(color = "#781500", size = 1.5) +  # Línea principal
  geom_point(color = "#781500", size = 3) +  # Puntos clave
  geom_text(aes(label = round(Volatilidad, 4)), 
            vjust = -1, size = 5, fontface = "bold") +  # Etiquetas de valores
  ylim(lim_y_min, lim_y_max) +
  labs(
    title = "
    
    ",
    x = "Año",
    y = "Volatilidad",
    caption = "Fuente: Elaboración propia con datos del INEGI"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

graf_volatil_ocupacion  # Mostrar la gráfica en el PDF

```

### *c)* Obtenga una serie anual de productividad laboral en México, que abarque el periodo de la pandemia. Grafíquela.

A continuación se presentan los datos de los Índices de Productividad Laboral desde el primer trimestre de 2019 hasta el cuarto trimestre de 2023. Estos datos han sido obtenidos del Instituto Nacional de Estadística y Geografía (INEGI).


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Índice global de productividad"}
# Cargar librerías necesarias
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)

# Leer el archivo desde el dominio de trabajo sin ruta absoluta
PRDATA <- read_xlsx("PRDATA.xlsx")

# Asegurar que los nombres de las columnas sean caracteres
colnames(PRDATA) <- as.character(colnames(PRDATA))

# Filtrar datos de productividad de la economía
df_productividad <- PRDATA %>%
  filter(`Sector SCIAN` == "Productividad de la economía") %>%
  select(-`Sector SCIAN`) %>%
  mutate(across(everything(), as.character))

# Transformar los datos a formato largo y limpiar
df_long <- df_productividad %>%
  pivot_longer(cols = everything(),
               names_to = "Trimestre",
               values_to = "Índice") %>%
  filter(!is.na(Índice) & Índice != "-") %>%
  mutate(Índice = as.numeric(Índice)) %>%
  separate(Trimestre, into = c("Año", "Trimestre"), sep = "-") %>%
  mutate(Año = as.numeric(Año),
         Trimestre = case_when(
           Trimestre == "1T" ~ 1,
           Trimestre == "2T" ~ 4,
           Trimestre == "3T" ~ 7,
           Trimestre == "4T" ~ 10,
           TRUE ~ NA_real_
         ),
         Fecha = as.Date(paste0(Año, "-", Trimestre, "-01"))) %>%
  drop_na()

# Crear la gráfica
graf_productividad <- ggplot(df_long, aes(x = Fecha, y = Índice)) +
  geom_line(color = "#611606", size = 2) +  # Línea principal
  geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +  # Línea de tendencia
  labs(
    title = "",
    x = "Año",
    y = "Índice de Productividad",
    caption = "Fuente: Elaboración propia con datos del INEGI"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
    axis.title = element_text(face = "bold", size = 14),
    axis.text = element_text(size = 12),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank()
  ) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") + 
  ylim(50, 130)

graf_productividad  # Mostrar la gráfica en el PDF


```
Por otro lado, tenemos las series de los Índices de Productividad Laboral por sector desde el primer trimestre de 2019 hasta el cuarto trimestre de 2023, obtenidos de la misma fuente.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=4,fig.pos="H", fig.align="center", fig.cap="Índice de productividad por sector "}

# Cargar librerías necesarias
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
library(patchwork)  # Para combinar gráficos

# Leer el archivo desde el dominio de trabajo sin ruta absoluta
PRDATA <- read_xlsx("PRDATA.xlsx")

# Asegurar que los nombres de las columnas sean caracteres
colnames(PRDATA) <- as.character(colnames(PRDATA))

# Filtrar datos de productividad por sector
df_primaria <- PRDATA %>% filter(`Sector SCIAN` == "Actividad primaria") %>% select(-`Sector SCIAN`)
df_secundaria <- PRDATA %>% filter(`Sector SCIAN` == "Actividad secundaria") %>% select(-`Sector SCIAN`)
df_terciaria <- PRDATA %>% filter(`Sector SCIAN` == "Actividad terciaria") %>% select(-`Sector SCIAN`)

# Convertir todas las columnas a caracteres
df_primaria <- df_primaria %>% mutate(across(everything(), as.character))
df_secundaria <- df_secundaria %>% mutate(across(everything(), as.character))
df_terciaria <- df_terciaria %>% mutate(across(everything(), as.character))

# Función para transformar los datos
df_transform <- function(df) {
  df %>%
    pivot_longer(cols = everything(), names_to = "Trimestre", values_to = "Índice") %>%
    filter(!is.na(Índice) & Índice != "-") %>%
    mutate(Índice = as.numeric(Índice)) %>%
    separate(Trimestre, into = c("Año", "Trimestre"), sep = "-") %>%
    mutate(Año = as.numeric(Año),
           Trimestre = case_when(
             Trimestre == "1T" ~ 1,
             Trimestre == "2T" ~ 4,
             Trimestre == "3T" ~ 7,
             Trimestre == "4T" ~ 10,
             TRUE ~ NA_real_
           ),
           Fecha = as.Date(paste0(Año, "-", Trimestre, "-01"))) %>%
    drop_na() %>%
    filter(Año >= 2019)
}

# Aplicar la transformación a cada sector
df_primaria <- df_transform(df_primaria)
df_secundaria <- df_transform(df_secundaria)
df_terciaria <- df_transform(df_terciaria)

# Función para crear gráficos individuales
crear_grafico <- function(df, titulo) {
  ggplot(df, aes(x = Fecha, y = Índice, group = 1)) +
    geom_line(size = 1, color = "#781500") +
    geom_smooth(method = "lm", se = FALSE, color = "#777777", linetype = "dashed") +
    labs(title = titulo, x = "Año", y = "Índice de Productividad") +
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5, margin = margin(b = 10)),  
      axis.title = element_text(size = 12, face = "bold"),  
      axis.text = element_text(size = 10),  
      panel.background = element_rect(fill = "white", color = NA),  
      plot.background = element_rect(fill = "white", color = NA),  
      panel.grid.major = element_line(color = "gray90"),  
      panel.grid.minor = element_blank()
    ) 
}

# Crear gráficos individuales para cada sector
grafico_primaria <- crear_grafico(df_primaria, "Sector Primario")
grafico_secundaria <- crear_grafico(df_secundaria, "Sector Secundario")
grafico_terciaria <- crear_grafico(df_terciaria, "Sector Terciario")

# Combinar los gráficos en una fila
graf_productividad_sectores <- (grafico_primaria | grafico_secundaria | grafico_terciaria) +
  plot_annotation(
    title = "",
    caption = "Fuente: Elaboración propia con datos del INEGI",
    theme = theme(plot.title = element_text(size = 18, face = "bold", hjust = 0.5, margin = margin(t = 20, b = 20)))
  )

graf_productividad_sectores  # Mostrar la gráfica en el PDF

```

### *d)*

Explique qué observa en los datos enfatizando si los datos parecen o no consistentes con los hechos estilizados para EEUU que se discutieron en clase.

#### **1. Tasa natural de desempleo**

La serie de ocupación, presentada en niveles, muestra una pendiente ligeramente positiva, pero con una tendencia estable en las tasas de ocupación trimestrales. A excepción del año 2020, donde se registró una disminución considerable de esta tasa, con una volatilidad de $0.05$ puntos. No obstante, para 2021, esta volatilidad comenzó a reducirse, permitiendo un retorno a una mayor estabilidad.

Por otro lado, la productividad presenta una tendencia a la baja, lo que sugiere que las empresas tienen incentivos para incrementar su demanda de trabajadores debido a la necesidad de aumentar la producción para alcanzar niveles más estables.

En el sector secundario, la disminución de la productividad se debe, en gran medida, a la reducción de la inversión fija, consecuencia de la incertidumbre económica generada durante la pandemia. Esta situación ha limitado la renovación e implementación de nueva maquinaria, así como la adopción de tecnologías que podrían mejorar la eficiencia productiva.

Por su parte, en el sector terciario, la productividad ha disminuido debido a la migración de muchos trabajadores hacia la informalidad, un fenómeno causado por la pérdida de empleos formales durante la pandemia. Este sector es el principal receptor de trabajo informal, el cual se caracteriza por bajos niveles de tecnología, capacitación y eficiencia. Además, la falta de inversión en el sector informal, resultado de la dificultad para acceder a créditos y la ausencia de políticas de apoyo gubernamental, ha impactado negativamente en su productividad.

Por lo que, se puede concluir que, en el largo plazo, la tasa de empleo tiende a una tasa natural, no obstante, puede tener variaciones debidas a choques externos. Por lo tanto, sí cumple el primer hecho estilizado.

#### **2. Salarios rígidos a la baja**


En relación con los salarios, se observa una tendencia generalizada al alza. Esto se debe a que, desde 2019, ha habido incrementos salariales impuestos por el ex-presidente Andrés Manuel López Obrador, creciendo nominalmente en un $58.76$% hasta 2024 con respecto a 2019.

No obstante, durante el periodo 2020-2021, hubo un descenso notable de los salarios medios reales, lo cual se atribuye a la disminución de la tasa de ocupación (Organización Internacional del Trabajo [OIT], 2022). Esto se refleja en el gráfico de ocupación trimestral, que muestra una fuerte caída desde el segundo trimestre de 2020 hasta el primer trimestre de 2021. Además, en 2021 y 2022, la inflación en el país alcanzó una tasa de casi $8$%, lo que ocasionó que los salarios reales disminuyeran aún más.

Finalmente, esto se puede atribuir al evento atípico de caracter global: la pandemia por COVID-19, pues a pesar de que hubo disminuciones de los salarios medios reales, no fueron sostenibles. 
Por lo que, se puede concluir que en largo plazo se observa, de manera general, la rigidez de los salarios a la baja y una flexibilidad al alza. Por lo tanto, se cumple el segundo hecho estilizado.

Podríamos concluir con un análisis de Gabriela Siller, directora de Análisis Económico y Financiero de Banco Base:

<center>
> **"De alguna manera se muestra el panorama del mercado laboral mexicano, como si se hubiera dado un cambio estructural tras la crisis del coronavirus. Aunque en términos de números ya se tiene la misma cantidad de empleos formales que se tenía antes de la crisis, no es el mismo mercado laboral, ahora hay menor productividad, salarios más bajos y un porcentaje alto en la subocupación y la informalidad"**
</center>


## **Ejercicio 3**

Desarrolle su intuición cuantitativa sobre la informalidad laboral en México siguiendo estos pasos [3 horas, 0.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar

### *a)*
Obtenga la Matriz Hussmans para México, del INEGI, para algún trimestre de 2021 o posterior.

```{r matriz_hussmanns, result='asis', echo=FALSE, message=FALSE, warning=FALSE}

# Cargamos algunas paqueterias que nos seran de utlidad despues para manejar
# la base de datos de la ENOE

library(dplyr)
library(tidyr)
library(flextable)
library(readr)
library(tibble)
library(knitr)

# La ENOE organiza sus datos en varias tablas: VIVT (ubicación de viviendas), 
#HOGT (datos del hogar y entrevistador), SDEM (información sociodemográfica) 
# y COE1/COE2 (ocupación y empleo).
#En SDEM, la sección "Clasificación de Microdatos" contiene los códigos sumarios 
#más relevantes para el análisis.



#Establecer el directorio de trabajo donde están los datos
setwd("C:/Users/danif/Colmex maestria/SEGUNDO SEMESTRE/MACROECONOMIA II/TAREAS/TAREA 1")

#Cargar la base de datos SDEM sin necesidad de escribir la ruta completa
sdem <- read_csv("conjunto_de_datos_sdem_enoe_2024_2t.csv")

# Ver las primeras filas para analizar la estructura


#Seleccionamos solo las variables que nos ayudan para construir las filas 
# de la matriz de acuerdo con la metodologia del inegi.

sdem_filtrado <- sdem %>%
  select(tue1, tue2, ambito1, emp_ppal, remune2c,pos_ocu, fac_tri)

# Creamos la variable MH_COL que tiene la informacion de las columnas de la
# matriz segun se indica en la metodologia de INEGI
sdem_filtrado <- sdem_filtrado %>%
  mutate(
    mh_col = case_when(
      (pos_ocu == 1 | pos_ocu == 5) & remune2c == 1 & emp_ppal == 1 ~ 1,
      (pos_ocu == 1 | pos_ocu == 5) & remune2c == 1 & emp_ppal == 2 ~ 2,
      ((pos_ocu == 1 & remune2c == 2) | (pos_ocu == 5)) & emp_ppal == 1 ~ 3,
      ((pos_ocu == 1 & remune2c == 2) | (pos_ocu == 5)) & emp_ppal == 2 ~ 4,
      pos_ocu == 2 & emp_ppal == 1 ~ 5,
      pos_ocu == 2 & emp_ppal == 2 ~ 6,
      pos_ocu == 3 & emp_ppal == 1 ~ 7,
      pos_ocu == 3 & emp_ppal == 2 ~ 8,
      pos_ocu == 4 & emp_ppal == 1 ~ 9,
      pos_ocu == 4 & emp_ppal == 2 ~ 10,
      
      TRUE ~ NA_real_
    )
  )

# HAcemos lo mismo para las filas 
sdem_filtrado <- sdem_filtrado %>%
  mutate(
    mh_fil2 = case_when(
      tue2 == 5 & ambito1 != 1 ~ 1,  # Sector informal
      tue1 == 3 & tue2 == 6 ~ 2,     # Trabajo doméstico remunerado
      (tue2 != 5 & tue1 != 3) & ambito1 != 1 ~ 3,  # Empresas, Gobierno e Instituciones
      ambito1 == 1 | (tue1 == 3 & tue2 == 7) ~ 4,  # Ámbito agropecuario
      TRUE ~ NA_real_
    )
  )


# Crear la Matriz de Hussmanns cruzando mh_col y mh_fil2
matriz_hussmanns <- sdem_filtrado %>%
  group_by(mh_fil2, mh_col) %>%
  summarise(total = sum(fac_tri, na.rm = TRUE)) %>%
  pivot_wider(names_from = mh_col, values_from = total, values_fill = 0)

library(kableExtra)
library(dplyr)
library(tidyr)

# Crear la Matriz Hussmanns asegurando 12 columnas, incluyendo la columna vacía
matriz_hussmanns <- tribble(
  ~"Clasificación", 
  ~"Asalariados (Informal)", ~"Asalariados (Formal)", 
  ~"Con percepciones no salariales (Informal)", ~"Con percepciones no salariales (Formal)", 
  ~"Empleadores (Informal)", ~"Empleadores (Formal)", 
  ~"Trabajadores por cuenta propia (Informal)", ~"Trabajadores por cuenta propia (Formal)", 
  ~"Trabajadores no remunerados (Informal)", ~"Trabajadores no remunerados (Formal)",  # ESTA COLUMNA ESTABA FALTANDO
  ~"Totales Informal", ~"Totales Formal",
  
  # Datos (conservando la columna vacía para evitar errores)
  "Sector Informal", "4870760", "", "631884", "", "1371763", "", "8953692", "", "1079117", "", "16907216", "",
  "Trabajo doméstico remunerado", "2295604", "99763", "20151", "278", "", "", "", "", "", "", "2315755", "100041",
  "Empresas, Gobierno e Instituciones", "6684614", "22617719", "828130", "163039", "", "1341671", "", "1920087", "527405", "", "8040149", "26042516",
  "Ámbito agropecuario", "2438912", "504313", "110429", "14453", "", "476709", "2149131", "", "701904", "", "5400376", "995475",
  "Subtotal", "16289890", "23221795", "1590594", "177770", "1371763", "1818380", "11102823", "1920087", "2308426", "", "32663496", "27138032",
  "Total", "39511685", "", "1768364", "", "3190143", "", "13022910", "", "2308426", "","", "59801528"
) %>%
  mutate(across(everything(), as.character))  # Convertir todas las columnas a texto

# Asegurar que hay exactamente 12 columnas
num_cols <- ncol(matriz_hussmanns)  # Debe ser 12

# Definir los nombres de las columnas (exactamente 12 nombres)
column_names <- c("Tipo de unidad económica\nempleadora", 
                  rep(c("Informal", "Formal"), 5),  # 5 grupos * 2 columnas = 10
                  "Subtotal", "Total")



tabla_latex <- matriz_hussmanns %>%
  knitr::kable(col.names = column_names, align = c('l', rep('c', num_cols - 1)), 
               format = "latex", booktabs = TRUE, escape = FALSE, 
               caption = "Matriz de Hussmanns. 2024:2T") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), 
                position = "center", font_size = 7, full_width = FALSE) %>%

  # Nivel 3: Encabezados detallados (sumando exactamente 12 columnas)
  add_header_above(c("Tipo de unidad económica\nempleadora", 
                     "Asalariados" = 2, 
                     "Con percepciones\nno salariales" = 2, 
                     "Empleadores" = 2, 
                     "Trabajadores por\ncuenta propia" = 2, 
                     "Trabajadores no\nremunerados" = 2, 
                     "Subtotal", "Total")) %>%

  # Nivel 2: Subcategorías principales (sumando exactamente 12 columnas)
  add_header_above(c(" ", "Trabajadores subordinados y\nremunerados" = 4, 
                     "Empleadores" = 2, "Cuenta propia" = 2, "No remunerados" = 2, "Subtotal", "Total")) %>%

  # Nivel 1: Encabezado general (sumando exactamente 12 columnas)
  add_header_above(c(" ", "Posición en la ocupación y condición de informalidad" = 11, " ")) %>%

  # Poner en negrita la fila "Total"
  row_spec(nrow(matriz_hussmanns), bold = TRUE)

tabla_latex  # Mostrar la tabla en PDF

```

La Matriz de Hussmanns se construye a partir de los microdatos abiertos de la ENOE, siguiendo la metodología oficial del INEGI para clasificar a los trabajadores según su ocupación y condición de informalidad. Aunque los resultados presentan mínimas diferencias con la matriz oficial, esto se debe a que nuestro cálculo se basa en los datos crudos sin ajustes adicionales. Aun así, la estructura refleja fielmente la segmentación del mercado laboral, permitiendo analizar la proporción de informalidad en cada sector económico.

### *b)*
A partir de la tabla, averigüe qué proporción de los trabajadores trabaja en el “sector informal” de la economía.

De un total de **59,801,528** trabajadores, aquellos que pertenecen al **sector informal** suman **16,907,216**, lo que representa aproximadamente un **28.3%** del total de trabajadores.

### *c)*
A partir de la tabla, averigüe qué proporción de los trabajadores del sector formal son informales.

Excluyendo el **sector informal** y **agropecuario** el total de trabajadores en sectores formales es **37,493,461**. De estos, **13,607,854** están en condiciones de **informalidad**, lo que equivale a un **36.3%** de los trabajadores en sectores formales. Según la metodología del INEGI, el ámbito agropecuario no se considera parte del sector informal, pero tampoco podemos decir que es completamente formal, ya que es un sector con una alta proporción de empleo no protegido.Por tanto, exlcuimos al sector agropecuario del amibito formal para este calculo.

### *d)*
Averigüe con datos del INEGI cuáles son las industrias formales
con mayor proporción de trabajadores informales y los estados de
la república con mayor proporción de trabajadores informales.

```{r matriz_hussmanns_ampliada, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

library(readr)

#Cargar la base de datos (ya se definió setwd antes, así que no repetimos la ruta completa)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)

# Cargar la base de datos
sdem_ampliado <- read_csv("conjunto_de_datos_sdem_enoe_2024_2t.csv")

# Crear la variable MH_FIL1 (Clasificación por Industria)
sdem_ampliado <- sdem_ampliado %>%
  mutate(
    MH_FIL1 = case_when(
      ambito1 == 1 & tue2 == 2 ~ 8,  # Actividades agropecuarias de mercado
      ambito1 == 1 & tue2 == 7 ~ 9,  # Agricultura de subsistencia
      tue1 == 4 ~ 7,  # Situaciones de carácter especial
      tue2 == 5 ~ 1,  # Sector informal
      tue2 == 6 ~ 2,  # Trabajo doméstico remunerado
      tue2 == 1 ~ 3,  # Empresas constituidas en sociedad
      tue2 == 4 ~ 6,  # Instituciones públicas
      tue2 == 3 ~ 5,  # Instituciones privadas
      tue2 == 2 ~ 4,  # Negocios no constituidos en sociedad
      TRUE ~ NA_real_
    )
  )

# Cruzar MH_FIL1 con MH_COL para obtener la matriz ampliada
matriz_hussmanns_ampliada <- sdem_ampliado %>%
  filter(!is.na(MH_FIL1)) %>%
  group_by(MH_FIL1, mh_col) %>%
  summarise(total = sum(fac_tri, na.rm = TRUE)) %>%
  pivot_wider(names_from = mh_col, values_from = total, values_fill = 0) %>%
  ungroup()

# Crear Matriz Hussmanns Ampliada con tribble()
matriz_hussmanns_ampliada <- tribble(
  ~"Tipo de Unidad Económica Empleadora", 
  ~"Asalariados (Informal)", ~"Asalariados (Formal)", 
  ~"Con percepciones no salariales (Informal)", ~"Con percepciones no salariales (Formal)", 
  ~"Empleadores (Informal)", ~"Empleadores (Formal)", 
  ~"Trabajadores por cuenta propia (Informal)", ~"Trabajadores por cuenta propia (Formal)", 
  ~"Trabajadores no remunerados (Informal)", ~"Trabajadores no remunerados (Formal)",  
  ~"Subtotal", ~"Total",
  
  # Datos de la tabla con espacios en blanco en vez de ceros
  "Sector Informal", "4870760", "", "631884", "", "1371763", "", "8953692", "", "1079117", "", "16907216", "",
  "Trabajo doméstico remunerado", "2295604", "99763", "20151", "278", "", "", "", "", "", "", "2315755", "100041",
  "Empresas constituidas en sociedad", "1437175", "242133", "", "", "30346", "1455749", "115588", "119149", "", "", "8040149", "26042516",
  "Negocios no constituidos en sociedad", "4064616", "312513", "", "", "37962", "1999868", "31172", "1209232", "1912160", "", "5400376", "995475",
  "Instituciones privadas", "308430", "33486", "", "", "13393", "699250", "5986", "7713", "", "", "", "",
  "Instituciones públicas", "769842", "39433", "", "", "85465", "5347473", "10293", "", "", "", "", "",
  "Situaciones de carácter especial", "104551", "200565", "", "", "18509", "13579", "", "5577", "7927", "", "", "",
  "Actividades agropecuarias de mercado", "2438912", "110429", "", "", "1518346", "128452", "504313", "14453", "476709", "", "32663496", "27138032",
  "Agricultura de subsistencia", "", "", "", "", "630785", "573452", "", "", "", "", "", "",

  # Subtotal (suma de las filas anteriores)
  "Subtotal", "16289890", "1590594", "1371763", "11102823", "2308426", "", "", "", "", "", "59801528", "",

  # Total (suma de todas las columnas)
  "Total", "39511685","", "1768364","", "3190143","", "13022910","", "2308426","","", "59801528"
) %>%
  mutate(across(everything(), as.character))

num_cols_ampliada <- ncol(matriz_hussmanns_ampliada)  # Debe ser 12

# Definir los nombres de las columnas (exactamente 12 nombres)
column_names_ampliada <- c("Tipo de unidad económica\nempleadora", 
                           rep(c("Informal", "Formal"), 5),  # 5 grupos * 2 columnas = 10
                           "Subtotal", "Total")

# Crear la tabla en formato LaTeX con `kableExtra`
tabla_latex_ampliada <- matriz_hussmanns_ampliada %>%
  knitr::kable(col.names = column_names_ampliada, align = c('l', rep('c', num_cols_ampliada - 1)), 
               format = "latex", booktabs = TRUE, escape = FALSE, 
               caption = "Matriz Hussmanns Ampliada. 2024:2T") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), 
                position = "center", font_size = 7, full_width = FALSE) %>%

  # Nivel 3: Encabezados detallados (exactamente 12 columnas)
  add_header_above(c("Tipo de unidad económica\nempleadora", 
                     "Asalariados" = 2, 
                     "Con percepciones\nno salariales" = 2, 
                     "Empleadores" = 2, 
                     "Trabajadores por\ncuenta propia" = 2, 
                     "Trabajadores no\nremunerados" = 2, 
                     "Subtotal", "Total")) %>%

  # Nivel 2: Subcategorías principales (exactamente 12 columnas)
  add_header_above(c(" ", "Trabajadores subordinados y\nremunerados" = 4, 
                     "Empleadores" = 2, "Cuenta propia" = 2, "No remunerados" = 2, "Subtotal", "Total")) %>%

  # Nivel 1: Encabezado general (exactamente 12 columnas)
  add_header_above(c(" ", "Posición en la ocupación y condición de informalidad" = 11, " ")) %>%

  # Poner en negrita la fila "Total"
  row_spec(nrow(matriz_hussmanns_ampliada), bold = TRUE)

tabla_latex_ampliada  # Mostrar la tabla en PDF 
```
Excluyendo al **Sector Informal**, las industrias formales con mayor proporción de **trabajadores informales** respecto a sus trabajadores formales son **Actividades agropecuarias de mercado**, donde hay **2,438,912** trabajadores informales frente a **110,429** formales, lo que representa aproximadamente **95.7%** de informalidad. Le siguen **Negocios no constituidos en sociedad**, con **4,064,616** trabajadores informales y **312,513** formales, con una proporción de **92.9%** de informalidad. Finalmente, **Situaciones de carácter especial** presenta **104,551** trabajadores informales y **20,565** formales, con una proporción de **83.6%** de informalidad. Estas cifras reflejan que la informalidad está más presente en sectores de **baja regulación y alta precarización laboral**.  

```{r matriz_hussmanns_por_entidad, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(dplyr)
library(knitr)
library(kableExtra)
library(scales)  # Para formato de números

# Crear diccionario de nombres de estados
diccionario_estados <- tibble(
  ent = 1:32,
  Estado = c("Aguascalientes", "Baja California", "Baja California Sur", "Campeche", "Coahuila", 
             "Colima", "Chiapas", "Chihuahua", "Ciudad de México", "Durango", "Guanajuato", 
             "Guerrero", "Hidalgo", "Jalisco", "México", "Michoacán", "Morelos", "Nayarit", 
             "Nuevo León", "Oaxaca", "Puebla", "Querétaro", "Quintana Roo", "San Luis Potosí", 
             "Sinaloa", "Sonora", "Tabasco", "Tamaulipas", "Tlaxcala", "Veracruz", "Yucatán", "Zacatecas")
)

# Filtrar datos para excluir el sector informal y agrupar por entidad
matriz_por_entidad <- sdem_ampliado %>%
  filter(MH_FIL1 != 1) %>%  # Excluir sector informal
  group_by(ent) %>%  # Agrupar por entidad
  summarise(
    Trabajadores_Informales = sum(ifelse(emp_ppal == 1, fac_tri, 0), na.rm = TRUE),
    Trabajadores_Formales = sum(ifelse(emp_ppal == 2, fac_tri, 0), na.rm = TRUE)
  ) %>%
  mutate(Proporcion_Informales = Trabajadores_Informales / (Trabajadores_Formales + Trabajadores_Informales)) %>%
  arrange(desc(Proporcion_Informales)) %>%  # Ordenar de mayor a menor proporción
  left_join(diccionario_estados, by = "ent") %>%  # Unir con los nombres de estados
  select(Estado, Trabajadores_Informales, Trabajadores_Formales, Proporcion_Informales) %>%  # Reordenar columnas
  mutate(
    Trabajadores_Informales = format(Trabajadores_Informales, big.mark = ","),
    Trabajadores_Formales = format(Trabajadores_Formales, big.mark = ","),
    Proporcion_Informales = percent(Proporcion_Informales, accuracy = 0.01)  # Convertir a porcentaje con 2 decimales
  )

# Crear la tabla en formato LaTeX
tabla_por_entidad <- kable(matriz_por_entidad, format = "latex", booktabs = TRUE, align = "c",
      col.names = c("Entidad", "Informales", "Formales", "Proporción"),
      caption = "Proporción de trabajadores informales en el sector formal por entidad") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

tabla_por_entidad 

```
Las entidades con mayor proporción de trabajadores informales en el sector formal incluyen **Oaxaca (67.88%), Chiapas (65.87%), Guerrero (63.96%) e Hidalgo (57.83%), todas con niveles superiores al 50%**. Estas entidades comparten características estructurales como altos niveles de empleo en sectores poco regulados, menor presencia de grandes empresas y mayor dependencia del trabajo independiente. En contraste, los estados con menor proporción de informalidad dentro del sector formal son **Nuevo León (17.36%), Baja California (23.08%) y Querétaro (25.12%)**, donde hay una mayor concentración de industrias manufactureras y empleo asalariado con mejores condiciones laborales. Esto refleja una marcada **heterogeneidad regional**, donde las economías más industrializadas tienden a reducir la informalidad, mientras que las economías con mayor **dependencia de actividades primarias** presentan tasas más elevadas.
### *e)*
Obtenga una medida de salario por industria y grafique el nivel de
informalidad contra el salario.

```{r guardar_grafica, echo=FALSE, message=FALSE, warning=FALSE, fig.width=7, fig.height=5, fig.align="center", fig.cap="Relación entre informalidad y salario por industria"}

library(dplyr)
library(ggplot2)
library(scales)
library(ggrepel)

# Calcular total de trabajadores informales por industria (excluyendo sector informal)
informalidad_vs_salario <- sdem_ampliado %>%
  filter(MH_FIL1 != 1) %>%
  group_by(MH_FIL1) %>%
  summarise(
    Trabajadores_Informales = sum(ifelse(emp_ppal == 1, fac_tri, 0), na.rm = TRUE),
    Total_Trabajadores = sum(fac_tri, na.rm = TRUE),
    Salario_Promedio = mean(salario, na.rm = TRUE)
  ) %>%
  mutate(Proporcion_Informales = Trabajadores_Informales / Total_Trabajadores) %>%
  arrange(desc(Proporcion_Informales))

# Diccionario de industrias
diccionario_industrias <- tibble(
  MH_FIL1 = 2:9,
  Industria = c("Trabajo doméstico remunerado", "Empresas constituidas en sociedad",
                "Negocios no constituidos en sociedad", "Instituciones privadas",
                "Instituciones públicas", "Situaciones de carácter especial",
                "Actividades agropecuarias de mercado", "Agricultura de subsistencia")
)

# Unir nombres de industrias
informalidad_vs_salario <- informalidad_vs_salario %>%
  left_join(diccionario_industrias, by = "MH_FIL1") %>%
  select(Industria, Proporcion_Informales, Salario_Promedio)

# Crear la gráfica
grafica <- ggplot(informalidad_vs_salario, aes(x = Proporcion_Informales, y = Salario_Promedio, label = Industria)) +
  geom_point(color = "#800020", size = 3) +
  geom_text_repel(size = 2.8, box.padding = 0.5, max.overlaps = 10) +
  labs(title = "",
       x = "Proporción de Trabajadores Informales",
       y = "Salario Promedio (MXN)") +
  scale_x_continuous(labels = percent_format(accuracy = 1)) +
  scale_y_continuous(labels = comma) +
  theme_minimal(base_size = 12) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_line(color = "gray95"),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

grafica
```
La gráfica muestra lo que parece ser una **relación negativa** entre la proporción de trabajadores informales en sectores formales y el salario promedio. Se observa que industrias con **mayor presencia de trabajadores informales**, como agricultura de subsistencia, trabajo doméstico remunerado y actividades agropecuarias de mercado, presentan los **salarios más bajos**. Por el contrario, sectores con menor informalidad, como empresas constituidas en sociedad e instituciones públicas, tienen salarios más elevados. Esto sugiere que la informalidad en sectores formales está asociada con menores ingresos para los trabajadores.





### *f)*
Utilice las estadísticas del INEGI para medir la economía informal
(MEI) para hacer un cálculo sencillo de la productividad laboral en
la formalidad vs la informalidad.
```{r, result='asis', echo=FALSE, message=FALSE, warning=FALSE}
# Cargar librerías necesarias
library(knitr)
library(kableExtra)
library(scales)  # Para formatear números con comas

# Crear el dataframe con los valores calculados
tabla_productividad <- data.frame(
  Categoría = c("VAB Informal", "VAB Formal", 
                "Total Trabajadores Informales", "Total Trabajadores Formales",
                "Productividad Informal", "Productividad Formal", 
                "Relación Formal/Informal"),
  Valor = c(7420340, 22518601, 
            32663496, 27138032, 
            227.2, 829.9, 
            3.65)
)

# Formatear los valores: sin decimales y con separación de miles
tabla_productividad$Valor <- ifelse(tabla_productividad$Categoría %in% 
                                      c("VAB Informal", "VAB Formal", 
                                        "Total Trabajadores Informales", "Total Trabajadores Formales"),
                                    formatC(tabla_productividad$Valor, format = "f", big.mark = ",", digits = 0),
                                    formatC(tabla_productividad$Valor, format = "f", big.mark = ",", digits = 2))

# Generar la tabla en formato LaTeX para PDF y guardarla en un objeto
tabla_latex_mei <- tabla_productividad %>%
  kable(format = "latex", booktabs = TRUE, align = "c",
        col.names = c("Categoría", "Valor"),
        caption = "Comparación de Productividad entre Economía Formal e Informal (2023)") %>%
  kable_styling(latex_options = c("hold_position", "striped", "scale_down"))

# Mostrar la tabla en el PDF
tabla_latex_mei



```

En este análisis utilizamos datos del **INEGI** del campo "Medición de la informalidad" para calcular la productividad de la economía formal e informal en México, basándonos en el **Valor Agregado Bruto (VAB)** y el **número de trabajadores** en cada sector a partir de la **Matriz de Hussmanns 2024:2T**. Para ello, primero calculamos el **VAB formal** restando el **VAB informal** del **VAB total**:  

\[
VAB_{\text{formal}} = VAB_{\text{total}} - VAB_{\text{informal}}
\]

Después, sumamos el total de trabajadores informales y formales en todas las categorías de la matriz (asalariados, empleadores, cuenta propia y no remunerados). Con estos valores, obtenemos la **productividad** dividiendo el **VAB entre el total de trabajadores** en cada sector:  

\[
\text{Productividad} = \frac{VAB}{\text{Número Total de Trabajadores}}
\]

La **Matriz de Hussmanns** nos permite extender este cálculo a sectores específicos como el **sector informal, trabajo doméstico remunerado, empresas e instituciones, y el ámbito agropecuario**. Al calcular la **productividad sectorial** con la fórmula:  

\[
P_{\text{sector}} = \frac{VAB_{\text{sector}}}{T_{\text{sector}}}
\]

podemos comparar la eficiencia económica entre sectores y entre trabajadores **formales e informales** dentro de cada uno. Especificamente , los trabajadpres en la informalidad tienen una productividad de **un tercio** con respecto a la prpductividad formal .Estos resultados son clave para entender **las diferencias de productividad** entre la diferencia en la situación laboral de cada trabajador.

### *g)*
Enuncie algunas conclusiones tentativas sobre los resultados que obtuvo, relacionándolas con los modelos discutidos en clase.

Un ejemplo de como podemos relacionar los resultados del ejercicio 3 con alguno de los modelos de mercado laboral vistos en clase, particularmente el **modelo de salarios de eficiencia (Shapiro-Stiglitz)** explica por qué algunas empresas pagan salarios por encima del nivel de mercado para incentivar la productividad y reducir la rotación. En el **Ejercicio 3**, la **Figura 9** muestra que los sectores con mayor informalidad, como la **agricultura de subsistencia** y el **trabajo doméstico**, tienen los salarios más bajos. Esto sugiere que en estos sectores no se aplican mecanismos de eficiencia salarial porque los empleadores no dependen de la retención de trabajadores o el monitoreo del esfuerzo. En contraste, sectores más formales y estructurados, como **empresas constituidas en sociedad** o **instituciones públicas**, pagan salarios más altos, lo que confirma la relación entre **formalidad y salarios de eficiencia**.  

El **modelo insiders-outsiders** ayuda a entender por qué la informalidad persiste dentro del mercado laboral formal. La **Matriz de Hussmanns** revela que **36.3% de los trabajadores en sectores formales tienen condiciones de informalidad**, lo que indica que muchas empresas contratan trabajadores sin acceso a derechos laborales para reducir costos. Los **insiders**, quienes tienen contratos formales, pueden negociar mejores salarios y estabilidad, mientras que los **outsiders** (informales) tienen menos poder de negociación. Esto genera **dualidad en el mercado laboral**, dificultando la transición al empleo formal y perpetuando la segmentación del trabajo, especialmente en sectores donde la regulación laboral es más laxa.  

Desde la perspectiva de los **modelos de búsqueda y emparejamiento**, la alta tasa de informalidad en México refleja **fricciones en el acceso al empleo formal**. La **Tabla 4** muestra que la **productividad en el sector informal es 3.65 veces menor que en el sector formal**, lo que sugiere que los trabajadores podrían ser más productivos si tuvieran acceso a empleos mejor estructurados. Sin embargo, las **barreras de entrada al mercado formal** (requisitos de experiencia, costos de contratación, rigideces salariales) hacen que muchos trabajadores acepten empleos informales de menor calidad mientras buscan oportunidades en el sector formal. Esta situación es evidente en la **alta tasa de subempleo (12.65% en 2021)**, que indica que una parte significativa de los trabajadores no logra encontrar empleo acorde con sus habilidades y expectativas salariales.  

En conclusión, los resultados del **Ejercicio 3** confirman la relevancia de estos modelos en la explicación de la **informalidad laboral en México**. La existencia de **diferencias salariales entre sectores formales e informales** sugiere la aplicación parcial de **mecanismos de eficiencia salarial**. Al mismo tiempo, la **segmentación entre insiders y outsiders** limita la movilidad laboral y refuerza la **dualidad del mercado**. Finalmente, las **fricciones en la búsqueda de empleo** obligan a muchos trabajadores a permanecer en la informalidad, afectando la **productividad general del país**.  

## **Ejercicio 4**
Practique trabajar con datos laborales de México siguiendo estos pasos: [3 horas, 0.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar.

### *a)* Descargue los micro-datos de la ENOE (también del INEGI), correspondientes a los cuatro trimestres de 2021.

En este ejercicio se extrajeron micro-datos de la Encuesta Nacional de Ocupación y Empleo (ENOE) correspondientes a los 4 trimestres del 2021. De los 4 trimestres, utilizamos la tabla sociodemográfico SDEMT, que es donde se encontraban las variables de interés para analizar cada inciso siguiente.

### *b)* Calcule el desempleo en cada trimestre, explicando cómo lo calculo.

Para calcular la tasa de desempleo en cada trimestre, se hizo uso de variables precodificadas. Primero se filtró la base de tal manera que cumpliera con las especificaciones para utilizarlas, fueron r_def=00, c_res=1 o 3 y eda \>=15,\<=98, que significan: entrevista compelta, residente habitual o nuevo y que tengan edad entre 15 y 98 años, respectivamente. De esta base ya filtrada se tomaron las variables clase1=1 que es persona económicamente activa (PEA), clase 2=2 que es persona desocupada (PD), y fac_tri que nos dice a cuántas personas representa cada persona entrevistada de la muestra.

Con la base ya filtrada obtuvimos la población económicamente activa y desocupada de la población y finalmente calculamos la tasa de desempleo a partir de la formula:

La fórmula para calcular la tasa de desempleo es:  
$$ \frac{PD}{PEA} \times 1000 $$

La tasas de desempleo obtenidas para cada trimestre son:

```{r tabla desempleo, result='asis', echo=FALSE, message=FALSE, warning=FALSE}
# Establecer el directorio de trabajo
setwd("C:/Users/danif/Colmex maestria/SEGUNDO SEMESTRE/MACROECONOMIA II/TAREAS/TAREA 1")

# Cargar paquetes
library(readr)       # Para leer archivos CSV
library(dplyr)       # Para manipulación de datos
library(kableExtra)  # Para tablas en PDF

# Leer los archivos CSV directamente desde el directorio de trabajo
df_t1 <- read_csv("ENOEN_SDEMT121.csv", locale = locale(encoding = "LATIN1"))
df_t2 <- read_csv("ENOEN_SDEMT221.csv", locale = locale(encoding = "LATIN1"))
df_t3 <- read_csv("ENOEN_SDEMT321.csv", locale = locale(encoding = "LATIN1"))
df_t4 <- read_csv("ENOEN_SDEMT421.csv", locale = locale(encoding = "LATIN1"))

# Función para calcular la tasa de desempleo por trimestre
calcular_tasa_desempleo <- function(df) {
  df_filtrado <- df %>%
    filter(r_def == 0, c_res %in% c(1, 3), eda >= 15, eda <= 98)
  
  pea <- df_filtrado %>%
    filter(clase1 == 1)
  
  desocupados <- pea %>%
    filter(clase2 == 2)
  
  pea_exp <- sum(pea$fac_tri, na.rm = TRUE)
  desocupados_exp <- sum(desocupados$fac_tri, na.rm = TRUE)
  
  tasa <- (desocupados_exp / pea_exp) * 100
  return(tasa)
}

# Calcular tasas para cada trimestre
tasa_t1 <- calcular_tasa_desempleo(df_t1)
tasa_t2 <- calcular_tasa_desempleo(df_t2)
tasa_t3 <- calcular_tasa_desempleo(df_t3)
tasa_t4 <- calcular_tasa_desempleo(df_t4)

# Crear la matriz con las tasas de desempleo
matriz_tasas <- data.frame(
  Trimestre = c("Primer Trimestre", "Segundo Trimestre", "Tercer Trimestre", "Cuarto Trimestre"),
  Tasa_Desempleo = sprintf("%.2f%%", c(tasa_t1, tasa_t2, tasa_t3, tasa_t4))
)

# Crear la tabla en formato LaTeX
tabla_tasas <- kable(matriz_tasas, format = "latex", booktabs = TRUE, align = "c",
      col.names = c("Trimestre", "Tasa de Desempleo"),
      caption = "Tasa de Desempleo por Trimestre en 2021") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

tabla_tasas
```



### *c)* Calcule el subempleo en cada trimestre, explicando cómo lo calculó.

De la misma manenra que en el inciso anterior se filtraron los datos para poder utilizarlos. Ahora, las variables utilizadas fueron clase2=1 que es persona ocupada (PO), la variable sub_o=1 que es trabajador subocupado(POS), y nuevamente la variable fac_tri para calcular la tasa de subempleo de la población.

La tasa de subempleo la obtuvimos a partir de la formula:

 $$ \frac{POS}{PO} \times 1000 $$
Las tasas de subempleo obtenidas para cada trimestre son:

```{r tabla_subempleo, result='asis', echo=FALSE, message=FALSE, warning=FALSE}

setwd("C:/Users/danif/Colmex maestria/SEGUNDO SEMESTRE/MACROECONOMIA II/TAREAS/TAREA 1")

# Cargar paquetes necesarios
library(dplyr)
library(kableExtra)

# Función para calcular la tasa de subempleo por trimestre
calcular_tasa_subempleo <- function(df) { 
  df_filtrado <- df %>%
    filter(r_def == 0,
           c_res %in% c(1, 3),
           eda >= 15,
           eda <= 98)
  
  # Filtrar ocupados y subocupados
  ocupados <- df_filtrado %>%
    filter(clase2 == 1)  # Clase2 == 1 representa a los ocupados
  
  subocupados <- df_filtrado %>%
    filter(sub_o == 1)  # sub_o == 1 indica subocupados (ajusta si es necesario)
  
  # Calcular el total ponderado usando FAC_TRI
  ocupados_exp <- sum(ocupados$fac_tri, na.rm = TRUE)
  subocupados_exp <- sum(subocupados$fac_tri, na.rm = TRUE)
  
  # Calcular la tasa de subempleo
  tasa <- (subocupados_exp / ocupados_exp) * 100
  return(tasa)
}

# Calcular tasas para cada trimestre
tasa_sub_t1 <- calcular_tasa_subempleo(df_t1)
tasa_sub_t2 <- calcular_tasa_subempleo(df_t2)
tasa_sub_t3 <- calcular_tasa_subempleo(df_t3)
tasa_sub_t4 <- calcular_tasa_subempleo(df_t4)

# Crear un dataframe con las tasas calculadas
tasas_subempleo <- data.frame(
  Trimestre = c("Primer Trimestre", "Segundo Trimestre", "Tercer Trimestre", "Cuarto Trimestre"),
  Tasa_Subempleo = sprintf("%.2f%%", c(tasa_sub_t1, tasa_sub_t2, tasa_sub_t3, tasa_sub_t4))
)

# Crear la tabla en formato LaTeX para PDF
tabla_subempleo <- kable(tasas_subempleo, format = "latex", booktabs = TRUE, align = "c",
      col.names = c("Trimestre", "Tasa de Subempleo"),
      caption = "Tasa de Subempleo por Trimestre en 2021") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

tabla_subempleo


```


### *d)* Que fracción de los trabajadores labora en empresas micro (menos de 5 personas), pequeñas (entre 6 y 30 personas), medianas (31 a 100) y grandes (100+)

Nuevamente se utiliza la base filtrada y la variable fac_tri. Elegimos utilizar la variable ambito2 que nos dice la clasificacion de la poblacion ocupada según el tamaño de la unidad económica en subtotales, por lo que tambien utilizamos la variable ambito1 que nos dice la clasificación de la poblacion ocupada según el tamaño de la unidad económica en totales. La variable ambito2 tiene las especificaciones que nos pide el inciso, y la variable ambito1 tiene como entradas 1,2,3 que son ambito agropecuario, no agropecuario y sin especificacion respectivamente, como sólo del ambito no agropecuario se desglosan los tamaños de las unidades de trabajo, entonces utilizamos la variable ambito1=2 y de ambito2 no utilizamos las entradas 2 y 3 pues la suma de ambos es el valor de ambito2=1 que contempla a los micronegocios.

Calculamos la fracción de los trabajadores que laboran en cada clasificación y los resultados fueron los siguientes:

####
```{r tabla_tam_emp, result='asis', echo=FALSE, message=FALSE, warning=FALSE} 

# Cargar paquetes necesarios
library(dplyr)
library(kableExtra)

# Función para calcular la fracción de trabajadores por tamaño de unidad económica
calcular_frac_tamano_empresa <- function(df) {
  df_filtrado <- df %>%
    filter(r_def == 0,         # Solo población con respuesta válida
           c_res %in% c(1, 3), # Solo respuestas completas y válidas
           eda >= 15,          # Edad mínima 15 años
           eda <= 98,          # Edad máxima 98 años
           ambito1 == 2)       # Solo sector no agropecuario
  
  total_ocupados <- sum(df_filtrado$fac_tri, na.rm = TRUE)
  
  # Calcular fracción para cada categoría
  frac_micro <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 %in% c(2, 3)], na.rm = TRUE) / total_ocupados * 100
  frac_pequenas <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 == 4], na.rm = TRUE) / total_ocupados * 100
  frac_medianas <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 == 5], na.rm = TRUE) / total_ocupados * 100
  frac_grandes <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 == 6], na.rm = TRUE) / total_ocupados * 100
  frac_gobierno <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 == 7], na.rm = TRUE) / total_ocupados * 100
  frac_otros <- sum(df_filtrado$fac_tri[df_filtrado$ambito2 == 8], na.rm = TRUE) / total_ocupados * 100
  
  # Retornar un vector con los valores calculados
  return(c(frac_micro, frac_pequenas, frac_medianas, frac_grandes, frac_gobierno, frac_otros))
}

# Calcular fracciones para cada trimestre
fracciones_t1 <- calcular_frac_tamano_empresa(df_t1)
fracciones_t2 <- calcular_frac_tamano_empresa(df_t2)
fracciones_t3 <- calcular_frac_tamano_empresa(df_t3)
fracciones_t4 <- calcular_frac_tamano_empresa(df_t4)

# Crear un dataframe con los resultados
fracciones_empresas <- data.frame(
  Trimestre = c("Primer Trimestre", "Segundo Trimestre", "Tercer Trimestre", "Cuarto Trimestre"),
  Micronegocios = sprintf("%.2f%%", c(fracciones_t1[1], fracciones_t2[1], fracciones_t3[1], fracciones_t4[1])),
  Pequeñas = sprintf("%.2f%%", c(fracciones_t1[2], fracciones_t2[2], fracciones_t3[2], fracciones_t4[2])),
  Medianas = sprintf("%.2f%%", c(fracciones_t1[3], fracciones_t2[3], fracciones_t3[3], fracciones_t4[3])),
  Grandes = sprintf("%.2f%%", c(fracciones_t1[4], fracciones_t2[4], fracciones_t3[4], fracciones_t4[4])),
  Gobierno = sprintf("%.2f%%", c(fracciones_t1[5], fracciones_t2[5], fracciones_t3[5], fracciones_t4[5])),
  Otros = sprintf("%.2f%%", c(fracciones_t1[6], fracciones_t2[6], fracciones_t3[6], fracciones_t4[6]))
)

# Imprimir la tabla en formato LaTeX con un nombre de tabla visible en el PDF
tabla_tamano_emp <-kable(fracciones_empresas, format = "latex", booktabs = TRUE, align = "c",
      col.names = c("Trimestre", "Micronegocios", "Pequeñas", "Medianas", "Grandes", "Gobierno", "Otros"),
      caption = "Fracción de Trabajadores según Tamaño de la Unidad Económica (2021) \\label{tab:frac_tamano}",
table.envir = "table")%>%
  kable_styling(latex_options = c("hold_position"))

tabla_tamano_emp
```


### *e)* Calcule la media y la mediana de las horas trabajadas por persona que trabaja.

En este caso, utilizamos la variable hrsocup que nos dice el número de horas trabajadas por semana y nuevamente utilizamos la base filtrada y la variable fac_tri para obtener la media y la mediana de las horas trabajadas por semana de la población.

Los resultados obtenidos fueron los siguientes:

```{r tabla_med_mediana, result='asis', echo=FALSE,message=FALSE, warning=FALSE}

# Cargar paquetes necesarios
library(dplyr)
library(kableExtra)

# Función para calcular la media y mediana de horas trabajadas por persona
calcular_horas_trabajadas <- function(df) {
  # Filtrar la población ocupada (Clase2 = 1)
  df_filtrado <- df %>%
    filter(r_def == 0,         # Solo población con respuesta válida
           c_res %in% c(1, 3), # Solo respuestas completas y válidas
           eda >= 15,          # Edad mínima 15 años
           eda <= 98,          # Edad máxima 98 años
           clase2 == 1)        # Solo ocupados
  
  # Asegurar que 'hrsocup' y 'fac_tri' sean numéricos
  df_filtrado$hrsocup <- as.numeric(df_filtrado$hrsocup)
  df_filtrado$fac_tri <- as.numeric(df_filtrado$fac_tri)
  
  # Calcular la media ponderada
  media_horas <- weighted.mean(df_filtrado$hrsocup, df_filtrado$fac_tri, na.rm = TRUE)
  
  # Calcular la mediana ponderada
  df_filtrado <- df_filtrado[order(df_filtrado$hrsocup), ]  # Ordenar por horas trabajadas
  pesos_acumulados <- cumsum(df_filtrado$fac_tri)  # Sumar acumulada de los pesos
  peso_total <- sum(df_filtrado$fac_tri, na.rm = TRUE)
  mediana_horas <- df_filtrado$hrsocup[which(pesos_acumulados >= peso_total / 2)][1]  # Mediana ponderada
  
  # Retornar los resultados como un vector
  return(c(media_horas, mediana_horas))
}

# Calcular media y mediana para cada trimestre
resultados_t1 <- calcular_horas_trabajadas(df_t1)
resultados_t2 <- calcular_horas_trabajadas(df_t2)
resultados_t3 <- calcular_horas_trabajadas(df_t3)
resultados_t4 <- calcular_horas_trabajadas(df_t4)

# Crear un dataframe con los resultados
horas_trabajadas <- data.frame(
  Trimestre = c("Primer Trimestre", "Segundo Trimestre", "Tercer Trimestre", "Cuarto Trimestre"),
  Media_Horas = sprintf("%.2f", c(resultados_t1[1], resultados_t2[1], resultados_t3[1], resultados_t4[1])),
  Mediana_Horas = sprintf("%.2f", c(resultados_t1[2], resultados_t2[2], resultados_t3[2], resultados_t4[2]))
)

# Imprimir la tabla en formato LaTeX con título y etiqueta para referencia
kable(horas_trabajadas, format = "latex", booktabs = TRUE, align = "c",
      col.names = c("Trimestre", "Media de Horas", "Mediana de Horas"),
      caption = "Media y Mediana de Horas Trabajadas por Trimestre (2021) con Filtros Aplicados \\label{tab:horas_trabajadas}") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))


```

### *f)* Grafique la relación entre el ingreso promedio y la edad de los trabajadores.

Para realizar este inciso una vez más filtramos la base, como bien se mencionó antes, la edad a considerar es de 15 a 98 años. Utilizamos también la variable ing_x_hrs que nos dice el ingreso promedio por hora trabajada. Posteriormente para poder obtener la relación entre el ingreso promedio por edad, lo primero que hicimos fue agrupar por edad y calcular el ingreso promedio por cada grupo de edad, por supesto utilizando la variable fac_tri. Finalmente graficamos la relacion entre edad e ingreso promedio por hora para cada trimestre correspondiente.

```{r edad_ing_grafica, echo=FALSE, message=FALSE, warning=FALSE, fig.width=7,fig.pos="H", fig.height=5, fig.align="center", fig.cap="Relacion ingreso promedio por hora y  edad"}

# Cargar librerías necesarias
library(ggplot2)
library(dplyr)
library(gridExtra)  # Para combinar múltiples gráficos

# Función para graficar la relación entre ingreso promedio y edad (promediado por edad)
graficar_ingreso_edad_promediado <- function(df, trimestre) {
  # Filtrar la base de datos aplicando los filtros ya usados
  df_filtrado <- df %>%
    filter(r_def == 0,         # Solo población con respuesta válida
           c_res %in% c(1, 3), # Solo respuestas completas y válidas
           eda >= 15,          # Edad mínima 15 años
           eda <= 98)          # Edad máxima 98 años
  
  # Agrupar por edad y calcular el ingreso promedio por cada grupo de edad
  df_promediado <- df_filtrado %>%
    group_by(eda) %>%
    summarise(ing_promedio = weighted.mean(ing_x_hrs, fac_tri, na.rm = TRUE))  # Ingreso promedio ponderado
  
  # Crear el gráfico
  p <- ggplot(df_promediado, aes(x = eda, y = ing_promedio)) +
    geom_point(alpha = 0.5, color = "blue") +  # Puntos del gráfico
    geom_smooth(method = "loess", color = "red", se = FALSE) + # Línea de tendencia
    labs(
      title = trimestre,
      x = "Edad (años)",
      y = "Ingreso Promedio por Hora"
    ) +
    theme_minimal()  # Estilo minimalista
  
  return(p)
}

# Generar los gráficos para cada trimestre
p1 <- graficar_ingreso_edad_promediado(df_t1, "Primer Trimestre")
p2 <- graficar_ingreso_edad_promediado(df_t2, "Segundo Trimestre")
p3 <- graficar_ingreso_edad_promediado(df_t3, "Tercer Trimestre")
p4 <- graficar_ingreso_edad_promediado(df_t4, "Cuarto Trimestre")

# Combinar los 4 gráficos en una cuadrícula 2x2
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)


```




### *Resultados*
Pudimos observar que la tasa de desempleo promedio para el año 2021 fue aproximadamente 4.1%, donde la tasa más alta se obtuvo en el primer trimestre y la más baja en el último trimestre. Lo mismo ocurrió con la tasa de subempleo, en el que para el año 2021 en promedio fue aproximandamente 12.65%. Respecto al tamaño de la unidad económica, para el año 2021 se vió mayor concentración en cada uno de los trimestres en los micronegocios, llevandose cerca del 50% del total, y aquí también podemos notar que la fracción de los trabajadores por tamaño de la unidad economica disminuye conforme el tamaño de la unidad crece. Se obtuvo en cada trimestre que en promedio trabajan aproximadamente 40 horas por semana, que es menor que las acordadas por el país. Además, con una media de 44 en los dos primeros trimestres y de 45 en los dos sigueintes. Por último, graficando la relación ingreso promedio & edad, lo que pudimos observar es que el ingreso promedio tiende a ir ascendiendo y que existe un ingreso promedio más alto entre las edades 25 a 60 años aproximadamente y despues comienza a descender. También pudimos notar que para el tercer trimestre, al menos en algunas edades el ingreso promedio creció con respecto a los anteriores.
